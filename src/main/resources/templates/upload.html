<!DOCTYPE html>
<html>
<head>
  <title>Song Upload</title>
</head>
<body>
<form id="uploadForm" enctype="multipart/form-data">
  <input type="text" name="songName" id="songName" placeholder="Song Name" required>
  <input type="text" name="artistName" id="artistName" placeholder="Artist Name" required>
  <input type="text" name="album" id="album" placeholder="Album">
  <input type="number" name="releaseYear" id="releaseYear" placeholder="Release Year" required>
  <input type="file" name="file" id="fileInput" required>
  <button type="submit">Upload</button>
</form>

<table id="songTable">
  <thead>
  <tr>
    <th>Song Name</th>
    <th>Artist</th>
    <th>Album</th>
    <th>Year</th>
    <th>Actions</th>
  </tr>
  </thead>
  <tbody id="songList"></tbody>
</table>

<audio id="audioPlayer" controls></audio>

<script>
  document.getElementById('uploadForm').addEventListener('submit', function (e) {
    e.preventDefault();
    var fileInput = document.getElementById('fileInput');
    var file = fileInput.files[0];

    var formData = new FormData();
    formData.append('file', file);
    formData.append('songName', document.getElementById('songName').value);
    formData.append('artistName', document.getElementById('artistName').value);
    formData.append('album', document.getElementById('album').value || '');
    formData.append('releaseYear', document.getElementById('releaseYear').value);

    fetch('/songs/upload', {
      method: 'POST',
      body: formData
    })
            .then(function (response) {
              return response.json();
            })
            .then(function (song) {
              var songList = document.getElementById('songList');

              var row = document.createElement('tr');
              row.innerHTML = `
          <td>${song.songName}</td>
          <td>${song.artistName}</td>
          <td>${song.album || ''}</td>
          <td>${song.releaseYear}</td>
          <td>
            <button class="playButton">Play</button>
          </td>
        `;

              row.querySelector('.playButton').addEventListener('click', function () {
                fetch('/songs/' + song.id + '/file')
                        .then(function (response) {
                          if (!response.ok) {
                            throw new Error('Failed to retrieve the song file');
                          }
                          return response.blob();
                        })
                        .then(function (blob) {
                          var fileUrl = URL.createObjectURL(blob);
                          var audioPlayer = document.getElementById('audioPlayer');
                          audioPlayer.src = fileUrl;
                          audioPlayer.play();
                        })
                        .catch(function (error) {
                          console.error('Error:', error);
                        });
              });

              songList.appendChild(row);
            })
            .catch(function (error) {
              console.error('Error:', error);
            });
  });
</script>
</body>
</html>
